!function(){if(!window.WebViewJavascriptBridge||!window.WebViewJavascriptBridge.inited){console.log(" 初始化了");var receiveMessageQueue=[],messageHandlers={},sendMessageQueue=[],responseCallbacks={},uniqueId=1,lastCallTime=0,stoId=null,FETCH_QUEUE_INTERVAL=20,messagingIframe,CUSTOM_PROTOCOL_SCHEME="yy",QUEUE_HAS_MESSAGE="__QUEUE_MESSAGE__";WebViewJavascriptBridge.init=init,WebViewJavascriptBridge.doSend=send,WebViewJavascriptBridge.registerHandler=registerHandler,WebViewJavascriptBridge.callHandler=callHandler,WebViewJavascriptBridge._handleMessageFromNative=_handleMessageFromNative,WebViewJavascriptBridge._fetchQueue=_fetchQueue;var readyEvent=document.createEvent("Events"),jobs=window.WVJBCallbacks||[];readyEvent.initEvent("WebViewJavascriptBridgeReady"),readyEvent.bridge=WebViewJavascriptBridge,window.WVJBCallbacks=[],jobs.forEach(function(e){e(WebViewJavascriptBridge)}),document.dispatchEvent(readyEvent)}function _createQueueReadyIframe(){(messagingIframe=document.createElement("iframe")).style.display="none",messagingIframe.src=CUSTOM_PROTOCOL_SCHEME+"://"+QUEUE_HAS_MESSAGE,document.documentElement.appendChild(messagingIframe)}function _createQueueReadyIframe4biz(){bizMessagingIframe=document.createElement("iframe"),bizMessagingIframe.style.display="none",document.documentElement.appendChild(bizMessagingIframe)}function init(e){if(WebViewJavascriptBridge._messageHandler)throw new Error("WebViewJavascriptBridge.init called twice");_createQueueReadyIframe(),_createQueueReadyIframe4biz(),WebViewJavascriptBridge._messageHandler=e;var a=receiveMessageQueue;receiveMessageQueue=null;for(var s=0;s<a.length;s++)_dispatchMessageFromNative(a[s]);WebViewJavascriptBridge.inited=!0}function send(e,a){_doSend("send",e,a)}function registerHandler(e,a){messageHandlers[e]=a}function removeHandler(e,a){delete messageHandlers[e]}function callHandler(e,a,s){console.log("走到 callHandler"),2==arguments.length&&"function"==typeof a&&(s=a,a=null),_doSend(e,a,s)}function _doSend(handlerName,message,responseCallback){var callbackId;"string"==typeof responseCallback?callbackId=responseCallback:responseCallback?(callbackId="cb_"+uniqueId+++"_"+(new Date).getTime(),responseCallbacks[callbackId]=responseCallback,message.callbackId=callbackId):callbackId="";try{var fn=eval("WebViewJavascriptBridge."+handlerName)}catch(e){console.log("这里出错了"+e)}if("function"==typeof fn){var responseData=fn.call(WebViewJavascriptBridge,JSON.stringify(message),callbackId);if(responseData){if(responseCallback=responseCallbacks[callbackId],!responseCallback)return;responseCallback(responseData),delete responseCallbacks[callbackId]}}sendMessageQueue.push(message),messagingIframe.src=CUSTOM_PROTOCOL_SCHEME+"://"+QUEUE_HAS_MESSAGE}function _fetchQueue(){if(0!==sendMessageQueue.length)if((new Date).getTime()-lastCallTime<FETCH_QUEUE_INTERVAL)stoId||(stoId=setTimeout(_fetchQueue,FETCH_QUEUE_INTERVAL));else{lastCallTime=(new Date).getTime(),stoId=null;var e=JSON.stringify(sendMessageQueue);sendMessageQueue=[],bizMessagingIframe.src=CUSTOM_PROTOCOL_SCHEME+"://return/_fetchQueue/"+encodeURIComponent(e)}}function _dispatchMessageFromNative(e){setTimeout(function(){var a,s=JSON.parse(e);if(s.responseId){if(!(a=responseCallbacks[s.responseId]))return;a(s.responseData),delete responseCallbacks[s.responseId]}else{if(s.callbackId){var n=s.callbackId;a=function(e){_doSend("response",e,n)}}var i=WebViewJavascriptBridge._messageHandler;s.handlerName&&(i=messageHandlers[s.handlerName]);try{i(s.data,a)}catch(e){"undefined"!=typeof console&&console.log("WebViewJavascriptBridge: WARNING: javascript handler threw.",s,e)}}})}function _handleMessageFromNative(e){receiveMessageQueue&&receiveMessageQueue.push(e),_dispatchMessageFromNative(e)}}();